(window.webpackJsonp=window.webpackJsonp||[]).push([[158],{1805:function(t,s,e){"use strict";e.r(s);var a=e(1),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"悲观锁-for-update"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#悲观锁-for-update"}},[t._v("#")]),t._v(" 悲观锁（for update）")]),t._v(" "),e("blockquote",[e("p",[t._v("本篇只介绍"),e("code",[t._v("for update")])])]),t._v(" "),e("p",[t._v('对于一个DQL语句，末尾可以加一个关键字"for update"')]),t._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" ename"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("sal "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" emp "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" job "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MANAGER'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("update")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("该语句作用：在本次事务执行过程中，job = 'MANAGER'的记录被查询。在这些"),e("strong",[t._v("记录查询的过程中")]),t._v("，任何其他事务都"),e("strong",[t._v("不能对这些记录进行修改操作")]),t._v("，直到当前事务结束")]),t._v(" "),e("p",[t._v("这种机制称为："),e("strong",[t._v("行级锁机制")]),t._v("（又叫"),e("strong",[t._v("悲观锁")]),t._v("！）")]),t._v(" "),e("h3",{attrs:{id:"注意"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[t._v("#")]),t._v(" 注意！")]),t._v(" "),e("p",[t._v("在mysql中，当使用 "),e("code",[t._v("select ... where ... for update")]),t._v(" 时，mysql进行"),e("strong",[t._v("row lock（行锁）"),e("strong",[t._v("还是")]),t._v("table lock（表锁）"),e("strong",[t._v("只取决于")]),t._v("是否能使用索引（例如主键，unique字段）")]),t._v("，"),e("strong",[t._v("能则为行锁，否则为表锁，未查到数据则无锁")]),t._v("。而使用 '<>'，'like'等操作时，索引会失效，自然进行的是table lock")]),t._v(" "),e("p",[t._v("但在oricle中都是行锁")]),t._v(" "),e("blockquote",[e("p",[t._v("所以慎用for update")])]),t._v(" "),e("p",[t._v("在使用for update时，最好是锁主键值，或者具有unique约束的字段，锁别的字段可能会导致整个表锁住")])])}),[],!1,null,null,null);s.default=r.exports}}]);